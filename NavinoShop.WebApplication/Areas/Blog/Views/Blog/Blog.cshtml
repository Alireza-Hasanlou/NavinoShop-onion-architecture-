@using Shared.Application
@model Query.Contract.UI.Blog.SingleBlogQueryModel
@{
    ViewData["title"] = Model.Seo.MetaTitle;
}
@section Seo {
    <partial name="_Seo" model="Model.Seo" />
}
<div class="container">
    <ul class="breadcrumbs">
        @foreach (var item in Model.BreadCrumbs.OrderBy(n => n.Number))
        {
            <li class="breadcrumbs__item">
                <a href="@item.Url" class="breadcrumbs__url">@item.Title</a>
            </li>
        }
    </ul>
</div>
<div class="main-container container" id="main-container">
    <div class="col-lg-12 blog__content mb-72">
        <div class="content-box">

            <article class="entry mb-0">

                <div class="single-post__entry-header entry__header">
                    <a href="/Blogs/@Model.CategorySlug" class="entry__meta-category entry__meta-category--label entry__meta-category--green">@Model.CategoryTitle</a>
                    <h1 class="single-post__entry-title">
                        @Model.Title
                    </h1>

                    <div class="entry__meta-holder">
                        <ul class="entry__meta">
                            <li class="entry__meta-author">
                                <span>نویسنده:</span>
                                <a href="#">@Model.Writer</a>
                            </li>
                            <li class="entry__meta-date">
                                @Model.CreateDate
                            </li>
                        </ul>

                        <ul class="entry__meta">
                            <li class="entry__meta-views">
                                <i class="ui-eye"></i>
                                <span>@Model.VisitCount</span>
                            </li>
                            <li class="entry__meta-comments">
                                <a href="#">
                                    <i class="ui-chat-empty"></i>@Model.CommentCount
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="entry__img-holder col-lg-8 col-sm-12 m-auto ">
                    <img src="@Model.ImageName" alt="@Model.ImageAlt" class="entry__img">
                </div>

                <div class="entry__article-wrap">

                    <div class="entry__article">
                        @Html.Raw(@Model.Text)
                    </div>
                </div>

                <!-- Related Posts -->
                @if (Model.RelateBlogs.Any())
                {
                    <section class="section mb-0">
                        <div class="title-wrap title-wrap--line">
                            <h3 class="section-title">مقالات مرتبط</h3>
                        </div>

                        <!-- Slider -->
                        <div class="owl-carousel owl-theme owl-carousel--arrows-outside owl-rtl">
                            @foreach (var post in Model.RelateBlogs)
                            {
                                <div class="item">
                                    <article class="entry thumb thumb--size-1">
                                        <div class="entry__img-holder thumb__img-holder"
                                             style="background-image: url(@post.ImageName">
                                            <div class="bottom-gradient"></div>

                                            <div class="thumb-text-holder">
                                                <h2 class="thumb-entry-title">
                                                    <a href="/Blog/@post.Slug">@post.Title</a>
                                                </h2>
                                            </div>

                                            <a href="/Blog/@post.Slug" class="thumb-url"></a>
                                        </div>
                                    </article>
                                </div>
                            }
                        </div>
                    </section>
                }


            </article>
            <!-- Comments -->
            <hr />
            <div class="entry-comments">
                <!-- Comment Form -->
                <div id="respond" class="comment-respond">
                    <div class="title-wrap">
                        <h5 class="comment-respond__title section-title">دیدگاه شما</h5>
                    </div>
                    <form id="form" class="comment-form" method="post" action="#">
                        <p class="comment-form-comment">
                            <label for="comment">دیدگاه</label>
                            <textarea id="comment" name="comment" rows="5" required="required"></textarea>
                        </p>

                        <div class="row row-20">
                            <div class="col-lg-6">
                                <label for="name">نام: *</label>
                                <input name="name" id="name" type="text">
                            </div>
                            <div class="col-lg-6">
                                <label for="comment">ایمیل: *</label>
                                <input name="email" id="email" type="email">
                            </div>

                        </div>

                        <p class="comment-form-submit">
                            <input type="submit" class="btn btn-lg btn-color btn-button" value="ارسال دیدگاه" id="submit-message">
                        </p>

                    </form>
                </div>
                <br />
                <div class="title-wrap title-wrap--line">
                    <h3 class="section-title">۳ دیدگاه</h3>
                </div>
                <ul class="comment-list">

                    <li class="comment" id="CommentParentli">




                        <ul class="children" id="CommentChild ">
                        </ul>

                    </li> <!-- end 1-2 comment -->



                </ul>
            </div> <!-- end comments -->


        </div> <!-- end content box -->
    </div>
</div>
@section scripts {
    <script>


        $(document).ready(function () {
                   function GetBlogsComments() { 
                       console.log("HEllo");
            $.ajax({
                url: "/Blog/Blog/GetBlogsComments",
                type: "GET",
                data: { ownerId: @Model.Id },
                dataType: "json"
            })
                .done(function (res) {
                  
                    var parent = $("#CommentParentli");
                    var replyParent = $("#CommentChild");

                    parent.empty();
                    replyParent.empty();

         

                    for (let i = 0; i < res.length; i++) {

                        // ---------- Tabs ----------
                        parent.append(`
                    <div class="comment-body" >
                        <div class="comment-avatar">
                                    <img alt="" src="${res[i].imageName}">
                                </div>
                                <div class="comment-text">
                                    <h6 class="comment-author">${res[i].fullName}</h6>
                                    <div class="comment-metadata">
                                        <a href="#" class="comment-date">${res[i].createDaate}</a>
                                    </div>
                                    <p>${res[i].text}</p>
                                    <a href="#" class="comment-reply">پاسخ</a>
                                </div>
                       </div>
                    `);

                

                            for (let i = 0; i < res.replys.length; i++) {

                                replyParent.append(`<li class="comment">
                                    <div class="comment-body">
                                        <div class="comment-avatar">
                                            <img alt="" src="${res.replys[i].imageName}">
                                        </div>
                                        <div class="comment-text">
                                            <h6 class="comment-author">${res.replys[i].fullName}</h6>
                                            <div class="comment-metadata">
                                                <a href="#" class="comment-date">${res.replys[i].createDaate}  </a>
                                            </div>
                                            <p>${res.replys[i].text}</p>
                                            <a href="#" class="comment-reply">پاسخ</a>
                                        </div>
                                    </div>
                                </li>
                    `);

                            }
                        

                    }
                })
                .fail(function (xhr) {
                    console.error("Ajax Error:", xhr.status, xhr.responseText);
                });
        }
            GetBestBlogs();
            $('.owl-carousel').owlCarousel({
                rtl: true,
                loop: true,
                margin: 15,
                nav: true,
                dots: false,
                autoplay: true,
                autoplayTimeout: 4000,
                 navText: [
            '<i class="fa fa-chevron-right"></i>',
            '<i class="fa fa-chevron-left"></i>'
        ],
                responsive: {
                    0: {
                        items: 1
                    },
                    768: {
                        items: 3
                    },
                    1200: {
                        items: 4
                    }
                }
            });
        });


    </script>
}